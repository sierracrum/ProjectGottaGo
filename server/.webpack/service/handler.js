!function(t,e){for(var o in e)t[o]=e[o]}(exports,function(t){var e={};function o(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,o),n.l=!0,n.exports}return o.m=t,o.c=e,o.d=function(t,e,r){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)o.d(r,n,function(e){return t[e]}.bind(null,n));return r},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=0)}([function(t,e,o){const r=o(1),n=o(2),s=o(3);r.config.update({region:process.env.R_AWS_REGION,accessKeyId:process.env.R_AWS_KEY,secretAccessKey:process.env.R_AWS_SECRET});const a=new r.DynamoDB;t.exports.auth=((t,e,o)=>{o(null,((t,e,o)=>{let r={};if(r.principalId=t,e&&o){const t={Version:"2012-10-17",Statement:[]},n={Action:"execute-api:Invoke"};n.Effect=e,n.Resource=o,t.Statement[0]=n,r.policyDocument=t}return r})("demo-user","Allow",t.methodArn))}),t.exports.getAllStatuses=((t,e,o)=>{const r={TableName:"risk-gtg-status",AttributesToGet:["id","buildingId","floorId","doorId","status","dt"]};a.scan(r,(t,e)=>{if(t)console.log(t),o("Failed getting status",t);else{let t=[];e.Items.map(e=>{t.push({id:e.id.S,doorId:parseInt(e.doorId.N),floorId:parseInt(e.floorId.N),buildingId:parseInt(e.buildingId.N),status:parseInt(e.status.N),dt:e.dt.S})}),o(null,s.sortBy(t,"dt").reverse())}})}),t.exports.getStatusById=((t,e,o)=>{const r={TableName:dbTableName,Key:{id:t.path.id}};a.get(r,(t,e)=>{t?(console.error(t),o("Failed fetching status",null)):o(null,JSON.stringify(e.Item))})}),t.exports.createStatus=((t,e,o)=>{const s=t.body;s||o("Status data required",null),s.buildingId||o("Building ID required",null),s.floorId||o("Floor ID required",null),s.doorId||o("Door ID required",null);const a={TableName:"risk-gtg-status",Item:{id:{S:n.v1()},buildingId:{N:s.buildingId.toString()},floorId:{N:s.floorId.toString()},doorId:{N:s.doorId.toString()},status:{N:s.status.toString()},dt:{S:(new Date).getTime().toString()}}},l=new r.DynamoDB;l.putItem(a,function(t,e){if(t)console.log(t),o("Failed storing status",t);else{const t={TableName:"risk-gtg-user",AttributesToGet:["id","userId","userName","dt"]};l.scan(t,(t,e)=>{t?(console.log(t),o("Failed fetching users",t)):o(null,!0)})}})}),t.exports.slackStatus=((t,e,o)=>{console.log("body",t.body);const r={TableName:"risk-gtg-status",AttributesToGet:["id","buildingId","floorId","doorId","status","dt"]};a.scan(r,(t,e)=>{if(t)console.log(t),o("Failed getting status",t);else{let t=[],e="",n=[];a.Items.map(t=>{n.push({id:t.id.S,doorId:parseInt(t.doorId.N),floorId:parseInt(t.floorId.N),buildingId:parseInt(t.buildingId.N),status:parseInt(t.status.N),dt:t.dt.S})}),s.sortBy(n,"dt").reverse().map(e=>{-1===s.findIndex(t,{doorId:e.doorId,floorId:e.floorId})&&t.push(e)});let a="",l={},i=[];for(let t=0;t<array.length;t++)1===array[t].status?l[array[t].floorId]?l[array[t].floorId]++:l[array[t].floorId]=1:i.push(array[t].floorId);for(var r in l){a+="F"+r+": "+l[r]+" available\n"}e=a.slice(0,a.length-1),o(null,{text:"Available Bathrooms: ",attachments:[{text:e,callback_id:"notify",color:"#3AA3E3",attachment_type:"default",actions:[{name:"notify",text:"Notify All",style:"danger",type:"button",value:"all"},{name:"notify",text:"Notify F1",type:"button",value:"F1"},{name:"notify",text:"Notify F2",type:"button",value:"F2"},{name:"notify",text:"Notify F3",type:"button",value:"F3"}]}]})}})}),t.exports.slackStatusNotify=((t,e,o)=>{const s=JSON.parse(t.body.payload);console.log(s);const a={TableName:"risk-gtg-user",Item:{id:{S:n.v1()},userId:{N:s.payload.user.id},user:{S:s.payload.user.user},action:{S:s.actions[0].value},dt:{S:(new Date).getTime().toString()}}};(new r.DynamoDB).putItem(a,function(t,e){t?(console.log(t),o("Failed storing status",t)):o(null,!0)})})},function(t,e){t.exports=require("aws-sdk")},function(t,e){t.exports=require("uuid")},function(t,e){t.exports=require("lodash")}]));
//# sourceMappingURL=handler.js.map