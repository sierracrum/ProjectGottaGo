!function(t,e){for(var o in e)t[o]=e[o]}(exports,function(t){var e={};function o(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}return o.m=t,o.c=e,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(n,r,function(e){return t[e]}.bind(null,r));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=0)}([function(t,e,o){const n=o(1),r=o(2),s=o(3);n.config.update({region:process.env.R_AWS_REGION,accessKeyId:process.env.R_AWS_KEY,secretAccessKey:process.env.R_AWS_SECRET});const i=new n.DynamoDB;t.exports.auth=((t,e,o)=>{o(null,((t,e,o)=>{let n={};if(n.principalId=t,e&&o){const t={Version:"2012-10-17",Statement:[]},r={Action:"execute-api:Invoke"};r.Effect=e,r.Resource=o,t.Statement[0]=r,n.policyDocument=t}return n})("demo-user","Allow",t.methodArn))}),t.exports.getAllStatuses=((t,e,o)=>{const n={TableName:"risk-gtg-status",AttributesToGet:["id","buildingId","floorId","doorId","status","dt"]};i.scan(n,(t,e)=>{if(t)console.log(t),o("Failed getting status",t);else{let t=[];e.Items.map(e=>{t.push({id:e.id.S,doorId:parseInt(e.doorId.N),floorId:parseInt(e.floorId.N),buildingId:parseInt(e.buildingId.N),status:parseInt(e.status.N),dt:e.dt.S})}),o(null,s.sortBy(t,"dt").reverse())}})}),t.exports.getStatusById=((t,e,o)=>{const n={TableName:dbTableName,Key:{id:t.path.id}};i.get(n,(t,e)=>{t?(console.error(t),o("Failed fetching status",null)):o(null,JSON.stringify(e.Item))})}),t.exports.createStatus=((t,e,o)=>{const s=t.body;s||o("Status data required",null),s.buildingId||o("Building ID required",null),s.floorId||o("Floor ID required",null),s.doorId||o("Door ID required",null);const i={TableName:"risk-gtg-status",Item:{id:{S:r.v1()},buildingId:{N:s.buildingId.toString()},floorId:{N:s.floorId.toString()},doorId:{N:s.doorId.toString()},status:{N:s.status.toString()},dt:{S:(new Date).getTime().toString()}}},l=new n.DynamoDB;l.putItem(i,function(t,e){if(t)console.log(t),o("Failed storing status",t);else{const t={TableName:"risk-gtg-user",AttributesToGet:["id","userId","userName","dt"]};l.scan(t,(t,e)=>{t?(console.log(t),o("Failed fetching users",t)):o(null,!0)})}})}),t.exports.slackStatus=((t,e,o)=>{console.log("body",t.body);const n={TableName:"risk-gtg-status",AttributesToGet:["id","buildingId","floorId","doorId","status","dt"]};i.scan(n,(t,e)=>{if(t)console.log(t),o("Failed getting status",t);else{let t=[],n="",r=[];e.Items.map(t=>{r.push({id:t.id.S,doorId:parseInt(t.doorId.N),floorId:parseInt(t.floorId.N),buildingId:parseInt(t.buildingId.N),status:parseInt(t.status.N),dt:t.dt.S})}),s.sortBy(r,"dt").reverse().map(e=>{-1===s.findIndex(t,{doorId:e.doorId,floorId:e.floorId})&&t.push(e)}),t.map(t=>{n+=`Elm F${t.floorId}\n`}),o(null,{text:"Available Bathrooms: ",attachments:[{text:n,callback_id:"notify",color:"#3AA3E3",attachment_type:"default",actions:[{name:"notify",text:"Notify All",style:"danger",type:"button",value:"all"},{name:"notify",text:"Notify F1",type:"button",value:"F1"},{name:"notify",text:"Notify F2",type:"button",value:"F2"},{name:"notify",text:"Notify F3",type:"button",value:"F3"}]}]})}})}),t.exports.slackStatusNotify=((t,e,o)=>{const s=JSON.parse(t.body.payload);console.log(s);const i={TableName:"risk-gtg-user",Item:{id:{S:r.v1()},userId:{S:s.user.id},userName:{S:s.user.name},action:{S:s.actions[0].value},dt:{S:(new Date).getTime().toString()}}};(new n.DynamoDB).putItem(i,function(t,e){t?(console.log(t),o("Failed storing status",t)):o(null,!0)})})},function(t,e){t.exports=require("aws-sdk")},function(t,e){t.exports=require("uuid")},function(t,e){t.exports=require("lodash")}]));
//# sourceMappingURL=handler.js.map